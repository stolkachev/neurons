function Clone_Neuron(n,t,i){var r=new Neuron;return r.Neuro_Layer=n,r.Name=i,r.External_id=t==-1?r.Id:t,r}function Add_Nerve(n,t,i){var u,f,r;if(n!=t&&!(n>personal_Neural_Net.neurons.length)&&!(t>personal_Neural_Net.neurons.length)){for(u=0;u<personal_Neural_Net.nerves.length;u++)if(f=personal_Neural_Net.nerves[u],f.From==n&&f.To==t)return f;return r=new Nerve,r.From=n,r.To=t,r.W=i,r}}function Add_Neuro_Layer(n,t,i,r,u){for(var o,f,e=0;e<personal_Neural_Net.neuro_Layers.length;e++)if(o=personal_Neural_Net.neuro_Layers[e],o.Name.toLowerCase()==u.toLowerCase())return o;return f=new Neuro_Layer,f.W=n,f.D=t,f.T=i,f.Delay_S=r,f.Name=u,f.W=n,f}function Find_Neuro_Layer_By_Name(n){for(var i,t=0;t<personal_Neural_Net.neuro_Layers.length;t++)if(i=personal_Neural_Net.neuro_Layers[t],i.Name.toLowerCase()==n.toLowerCase())return i;return null}function Find_Neuron_Id_By_Name(n,t){for(var r,i=0;i<personal_Neural_Net.neurons.length;i++)if(r=personal_Neural_Net.neurons[i],r.Name.toLowerCase()==n.toLowerCase()&&r.Neuro_Layer==t)return i;return-1}function Find_Neuron_By_Name(n,t){for(var r,i=0;i<personal_Neural_Net.neurons.length;i++)if(r=personal_Neural_Net.neurons[i],r.Name.toLowerCase()==n.toLowerCase()&&r.Neuro_Layer==t)return r;return null}function Find_Neuron_Id_By_External_Id(n,t){for(var r,i=0;i<personal_Neural_Net.neurons.length;i++)if(r=personal_Neural_Net.neurons[i],r.External_id==n&&r.Neuro_Layer==t)return i;return-1}function Find_Neuron_By_External_Id(n,t){for(var r,i=0;i<personal_Neural_Net.neurons.length;i++)if(r=personal_Neural_Net.neurons[i],r.External_id==n&&r.Neuro_Layer==t)return r;return null}function Set_Neuron_Name(n,t){var i=personal_Neural_Net.neurons[n];i.Name=t}function Set_Neuron_D(n,t){var i=personal_Neural_Net.neurons[n],r;i.D=t,r=+new Date,i.D_When=t*1e3+r}function Reset_Neurons(n){var i,t;if(n==null||n==undefined)for(i=0;i<personal_Neural_Net.neurons.length;i++)t=personal_Neural_Net.neurons[i],t.E=0,t.O=0,t.S=0,t.Curent_E=0,t.Charged=!1;else for(i=0;i<personal_Neural_Net.neurons.length;i++)t=personal_Neural_Net.neurons[i],t.Neuro_Layer==n&&(t.E=0,t.O=0,t.S=0,t.Curent_E=0,t.Charged=!1)}function Reset_Half_Charged_Neurons(n){var i,t;if(n!=null&&n!=undefined)for(i=0;i<personal_Neural_Net.neurons.length;i++)t=personal_Neural_Net.neurons[i],t.Neuro_Layer==n&&t.Curent_E<1&&(t.E=0,t.O=0,t.S=0,t.Curent_E=0,t.Charged=!1)}function Get_Excited_Neurons(n){var r=[],i,t;if(n==null||n==undefined)return null;for(i=0;i<personal_Neural_Net.neurons.length;i++)(t=personal_Neural_Net.neurons[i],t.Neuro_Layer==n)&&(t.Curent_E==1||t.E==1)&&r.push(t);return r}function Discharge_Me(n){n!=null&&(n.E_When=0,n.E=0,n.Curent_E=0,n.Charged=!1,n.O=0)}function Excite_Me(n,t){n!=null&&(t>1&&(t=1),t<-1&&(t=-1),n.Curent_E=t==1||t==-1||t==0?t:Number(n.Curent_E)+Number(t),n.Curent_E>1&&(n.Curent_E=1),n.Curent_E<-1&&(n.Curent_E=-1),n.Curent_E<=0&&(n.O=0),n.D>0&&Set_Discharge_Time(n,n.D,n.Neuro_Layer.Disharged_CallBack))}function Set_Discharge_Time(n,t,i){var r,u,f;n!=null&&(n.D=t,r=t*1e3,u=+new Date,n.D_When=r+u,f=setTimeout(function(){var t=+new Date;t<n.D_When||(n.Curent_E=0,n.E=0,n.Charged=!1,i!=null&&i())},r))}function Fire_Me(n){var r,u,i,t;if(n!=null){for(r=0,n.O=1,u=!1,i=0;i<personal_Neural_Net.nerves.length;i++)t=personal_Neural_Net.nerves[i],t.From==n.Id&&(r=n.O*t.W,Excite_Me(personal_Neural_Net.neurons[t.To],r),personal_Neural_Net.neurons[t.To].S=0,u=!0);u&&(n.E=0,n.Curent_E=0,n.Charged=!1,n.O=0)}}function Propagate(n){var r,i,t;if(n!=null){for(r=0,i=0;i<personal_Neural_Net.nerves.length;i++)t=personal_Neural_Net.nerves[i],t.From==n.Id&&(r=t.W,Excite_Me(personal_Neural_Net.neurons[t.To],r),personal_Neural_Net.neurons[t.To].S=0);n.E=0,n.Curent_E=0,n.Charged=!1,n.O=0}}function Excite_Word(n){var f,i,u,r,t;if(n!=null&&n!=undefined&&(f=Find_Neuro_Layer_By_Name("words"),i=Find_Neuron_By_Name(n,f),i!=null)){for(u=0,t=0;t<personal_Neural_Net.nerves.length;t++)r=personal_Neural_Net.nerves[t],r.From==i.Id&&(u=r.W,Excite_Me(personal_Neural_Net.neurons[r.To],u),personal_Neural_Net.neurons[r.To].S=0);for(t=0;t<personal_Neural_Net.neurons.length;t++)(personal_Neural_Net.neurons[t].Curent_E==1||personal_Neural_Net.neurons[t].E==1)&&Fire_Me(personal_Neural_Net.neurons[t]);i.E=0,i.Curent_E=0,i.Charged=!1,i.O=0}}function Excite_Phrase(n){var f="",u="",e,o,r,i,t;if(n!=null&&n!=""&&n!=undefined){if(e=Find_Neuro_Layer_By_Name("words"),n.indexOf(" ")<0)i=Find_Neuron_Id_By_Name(n,e),i>0?Propagate(personal_Neural_Net.neurons[i]):u=n;else for(o=n.split(" "),t=0;t<o.length;t++)(r=o[t],i=Find_Neuron_Id_By_Name(r,e),f.indexOf(r+":")>=0)||(f=f+r+":",i>0?Propagate(personal_Neural_Net.neurons[i]):u=u==""?r:u+":"+r);for(t=0;t<personal_Neural_Net.neurons.length;t++)(personal_Neural_Net.neurons[t].Curent_E==1||personal_Neural_Net.neurons[t].E==1)&&Fire_Me(personal_Neural_Net.neurons[t]);return}}function Build_Linguistic_Trigger(n,t,i){for(var f,e=0,o=0,s,u,r=i;r<i+t*2;r++)s=Clone_Neuron(n,r,r.toString());for(r=i;r<i+t;r++)for(e=Find_Neuron_Id_By_External_Id(r,n),u=i+t;u<i+t*2;u++)f=Find_Neuron_Id_By_External_Id(u,n),o=u==r+t?1:-1,Add_Nerve(e,f,o)}function Build_Neural_Layer(n){var h=Find_Neuro_Layer_By_Name("words"),c=new XMLHttpRequest,t,e,u,p,i,s,nt;c.open("GET",n,!1),c.send();var y=c.responseXML,k=y.getElementsByTagName("neuro_triggers"),d=k[0].getAttribute("name"),r=Add_Neuro_Layer(1,-1,1,1e3,d),l=r.Current_trigger_id,f=y.getElementsByTagName("neuro_trigger");for(t=0;t<f.length;t++)if(!(f[t].childNodes.length<1)){for(e=1,u=0;u<f[t].childNodes.length;u++)(i=f[t].childNodes[u],i.childNodes.length<1)||e++;for(p=f[t].getAttribute("name"),Build_Linguistic_Trigger(r,e,r.Current_trigger_id),l=r.Current_trigger_id,u=0;u<f[t].childNodes.length;u++)if(i=f[t].childNodes[u],!(i.childNodes.length<1)){var w=i.getAttribute("name"),g=i.getAttribute("discharge"),o=Find_Neuron_Id_By_External_Id(l,r);for(o>0&&(Set_Neuron_Name(o,w),Set_Neuron_Name(o+e,p+":"+w),Set_Neuron_D(o+e,+g)),l++,s=0;s<i.childNodes.length;s++)try{var b=i.childNodes[s],a=b.getAttribute("word"),v=Find_Neuron_Id_By_Name(a,h);v<0&&(nt=Clone_Neuron(h,-1,a));var v=Find_Neuron_Id_By_Name(a,h),tt=b.getAttribute("weight"),it=+tt;Add_Nerve(v,o,it)}catch(rt){}}r.Current_trigger_id=r.Current_trigger_id+e*2}return r}function Save_Linguistics_URL(n){var f,t,i,u,r;if(n!=null&&n!=undefined&&typeof Storage!="undefined")if(f=localStorage.getItem("neuro_layers_url"),t=JSON.parse(f),t==null)t=[],t.push(n),i=JSON.stringify(t),localStorage.setItem("neuro_layers_url",i);else{for(u=!1,r=0;r<t.length;r++)if(t[r]==n){u=!0;break}if(u)return;t.push(n),i=JSON.stringify(t),localStorage.setItem("neuro_layers_url",i)}}function Restore_Linguistics_URLs(){if(typeof Storage!="undefined"){var n=localStorage.getItem("neuro_layers_url");return JSON.parse(n)}return null}function Save_Neural_State(n){if(n!=null&&n!=undefined&&typeof Storage!="undefined"){var i=Get_Excited_Neurons(n),t;try{t=JSON.stringify(i),localStorage.setItem(n.Name,t)}catch(r){}}}function Restore_Neural_State(n){var u,i,r,f,e,t;if(n!=null&&n!=undefined&&typeof Storage!="undefined"&&(u=localStorage.getItem(n.Name),i=JSON.parse(u),i!=null))for(r=0;r<i.length;r++)t=i[r],f=+new Date,t.D_When=t.D*1e3+f,e=t.Name,t=Find_Neuron_By_Name(e,n),Excite_Me(t,1)}function RandomID(){for(var t="",i,n=0;n<16;n++)i=Math.floor(Math.random()*62),t+="0123456789abcdefghijklmnopqurstuvwxyzABCDEFGHIJKLMNOPQURSTUVWXYZ".substr(i,1);return t}var Neuron=function(){function n(){this.Neuro_Layer=null,this.Id=-1,this.External_id=-1,this.Name="",this.E=0,this.Curent_E=0,this.D=0,this.T=0,this.S=0,this.O=0,this.E_When=0,this.W_When=0,this.D_When=0,this.Charged=!1,personal_Neural_Net.neurons.push(this),this.Id=personal_Neural_Net.neurons.length-1}return n}(),Nerve=function(){function n(){this.From=-1,this.To=-1,this.W=0,personal_Neural_Net.nerves.push(this)}return n}(),Neuro_Layer=function(){function n(){this.Name="",this.Current_trigger_id=1,this.Disharged_CallBack=null,personal_Neural_Net.neuro_Layers.push(this)}return n}(),Personal_Neural_Net=function(){function n(){this.neurons=[],this.nerves=[],this.neuro_Layers=[]}return n}(),personal_Neural_Net=new Personal_Neural_Net,proto_neuron=new Neuron;proto_neuron.Name="Proto Neuron",proto_neuron.E=0,proto_neuron.Curent_E=0,proto_neuron.Charged=!1